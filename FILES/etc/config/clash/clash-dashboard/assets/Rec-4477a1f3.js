import{u as _e,r as l,j as e}from"./index-7d6a4c5b.js";const fe="_pageWrapper_17rb1_2",xe="_container_17rb1_11",be="_header_17rb1_22",me="_statsContainer_17rb1_28",je="_statsCards_17rb1_37",Ce="_statsCard_17rb1_37",ye="_statsCardTotal_17rb1_70",Se="_statsCardDownload_17rb1_93",Ne="_statsCardUpload_17rb1_97",we="_statsLabel_17rb1_102",ve="_statsValue_17rb1_111",ke="_breathingSlow_17rb1_1",De="_actionButtons_17rb1_152",Be="_btn_17rb1_157",Te="_btnPrimary_17rb1_177",Pe="_btnDanger_17rb1_185",Re="_btnSuccess_17rb1_193",Ie="_controls_17rb1_201",$e="_controlGroup_17rb1_210",Le="_searchInput_17rb1_221",Ue="_tableContainer_17rb1_235",Fe="_table_17rb1_235",ze="_thead_17rb1_248",Ae="_th_17rb1_248",Me="_thActive_17rb1_270",Oe="_tr_17rb1_275",We="_copyBtn_17rb1_285",Ve="_td_17rb1_289",Ee="_domainCell_17rb1_295",Ge="_ipTag_17rb1_320",Je="_moreTag_17rb1_341",Qe="_expandBtn_17rb1_347",He="_paginationWrapper_17rb1_360",Ke="_top_17rb1_369",qe="_pageControls_17rb1_374",Xe="_pageSizeSelect_17rb1_380",Ye="_pageBtn_17rb1_388",Ze="_loading_17rb1_410",et="_error_17rb1_410",tt="_footer_17rb1_420",at="_dialogOverlay_17rb1_434",st="_dialogBox_17rb1_448",ot="_dialogTitle_17rb1_459",nt="_dialogButtons_17rb1_463",rt="_progressBar_17rb1_471",lt="_progressFill_17rb1_481",ct="_refreshNotice_17rb1_487",a={pageWrapper:fe,container:xe,header:be,statsContainer:me,statsCards:je,statsCard:Ce,statsCardTotal:ye,statsCardDownload:Se,statsCardUpload:Ne,statsLabel:we,statsValue:ve,breathingSlow:ke,actionButtons:De,btn:Be,btnPrimary:Te,btnDanger:Pe,btnSuccess:Re,controls:Ie,controlGroup:$e,searchInput:Le,tableContainer:Ue,table:Fe,thead:ze,th:Ae,thActive:Me,tr:Oe,copyBtn:We,td:Ve,domainCell:Ee,ipTag:Ge,moreTag:Je,expandBtn:Qe,paginationWrapper:He,top:Ke,pageControls:qe,pageSizeSelect:Xe,pageBtn:Ye,loading:Ze,error:et,footer:tt,dialogOverlay:at,dialogBox:st,dialogTitle:ot,dialogButtons:nt,progressBar:rt,progressFill:lt,refreshNotice:ct};function dt(){const{t:n,i18n:E}=_e(),[P,G]=l.useState([]),[u,k]=l.useState("total"),[C,y]=l.useState("desc"),[S,J]=l.useState(!1),[R,Q]=l.useState(""),[j,I]=l.useState(!0),[f,D]=l.useState(""),[h,H]=l.useState(null),[$,K]=l.useState(new Set),[q,B]=l.useState(0),[X,L]=l.useState(!1),[Y,Z]=l.useState(!1),[d,U]=l.useState(20),[x,b]=l.useState(1),[m,ee]=l.useState({download:0,upload:0,total:0}),[te,N]=l.useState(!1),[T,F]=l.useState(!1),[ae,se]=l.useState(!1),oe=E.language.toLowerCase().startsWith("zh")?"zh":"en";l.useEffect(()=>{const t="PaoPaoGateWay",s=localStorage.getItem(t);if(!s){window.location.href="/ui/#/rec";return}try{const r=JSON.parse(s);if(!r.clashAPIConfigs||r.clashAPIConfigs.length===0){window.location.href="/ui/#/rec";return}H(r.clashAPIConfigs[0].secret)}catch{window.location.href="/ui/#/rec"}const o=sessionStorage.getItem("ppgw_pageSize");o&&U(o==="all"?"all":parseInt(o))},[]),l.useEffect(()=>{sessionStorage.setItem("ppgw_pageSize",d.toString())},[d]);const ne=t=>{const s=t.reduce((o,r)=>({download:o.download+r.download,upload:o.upload+r.upload,total:o.total+r.total}),{download:0,upload:0,total:0});ee(s)},w=async(t=!1)=>{if(h){D("");try{const s=Math.floor(Date.now()/1e3),o=await fetch("./reckey.json?_="+s);if(!o.ok)throw new Error("Failed to fetch reckey");const c=(await o.json()).reckey;if(!(await fetch("/version",{headers:{Authorization:"Bearer "+h}})).ok){D(n("authError")||"Authentication failed"),setTimeout(()=>{window.location.href="/ui/#/rec"},2e3);return}const W="./rec_data/"+sha256(c+h)+"/data.json?t="+s,v=await fetch(W);if(!v.ok)throw new Error("Failed to fetch data");const V=await v.json();G(V),ne(V),I(!1),L(!0),setTimeout(()=>{L(!1)},500)}catch(s){D(n("error")||"Failed to load data"),I(!1),console.error(s)}}},re=async()=>{if(h){F(!0);try{const t=Math.floor(Date.now()/1e3),s=await fetch("./reckey.json?_="+t);if(!s.ok)throw new Error("Failed to fetch reckey");const r=(await s.json()).reckey,i="./rec_data/"+sha256(r+h)+"/data_clean.json?t="+t,_=await fetch(i);if(!_.ok)throw new Error("Failed to clean data");if((await _.json()).clean==="ok")await new Promise(v=>setTimeout(v,3e3)),N(!1),await w();else throw new Error("Clean failed")}catch(t){console.error(t),alert(n("cleanError")),N(!1)}finally{F(!1)}}};l.useEffect(()=>{h&&w()},[h]),l.useEffect(()=>{let t=null,s=null;return S&&h?(B(0),s=setTimeout(()=>{w(!0)},3e3),t=setInterval(()=>{B(o=>o+100/30)},100)):B(0),()=>{t&&clearInterval(t),s&&clearTimeout(s)}},[S,h,P]);const p=t=>{if(t===0)return"0 B";const s=1024,o=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,r)).toFixed(2))+" "+o[r]},z=t=>new Date(t).toLocaleString(oe==="zh"?"zh-CN":"en-US"),le=t=>{u===t?y(C==="asc"?"desc":"asc"):(k(t),y("asc"))},g=()=>{let t=P.filter(s=>{const o=R.toLowerCase();return s.domain.toLowerCase().includes(o)||s.clientIPs.some(r=>r.toLowerCase().includes(o))});return u&&t.sort((s,o)=>{let r=s[u],c=o[u];return u==="clientIPs"?(r=r.length,c=c.length):u==="lastUpdate"&&(r=new Date(r),c=new Date(c)),r<c?C==="asc"?-1:1:r>c?C==="asc"?1:-1:0}),t},ce=()=>{const t=g();if(d==="all")return t;const s=(x-1)*d;return t.slice(s,s+d)},ie=()=>d==="all"?1:Math.ceil(g().length/d),de=t=>{U(t),b(1)},he=(t,s)=>{const o=r=>{s.textContent=n("copied")||"Copied",s.style.background="#28a745",s.style.color="#fff",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background="",s.style.color=""},1500)};navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>o()).catch(()=>A(t,s)):A(t,s)},A=(t,s)=>{try{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",document.body.appendChild(o),o.select();const r=document.execCommand("copy");if(document.body.removeChild(o),r)s.textContent=n("copied")||"Copied",s.style.background="#28a745",s.style.color="#fff",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background="",s.style.color=""},1500);else throw new Error("Copy failed")}catch{s.textContent=n("copyFailed")||"Failed",s.style.background="#dc3545",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background=""},1500)}},pe=t=>{const s=new Set($);s.has(t)?s.delete(t):s.add(t),K(s)},ue=()=>{const t=g();if(t.length===0){alert(n("noData"));return}let o=["Domain","Download","Upload","Total","Client IPs","Last Update"].join(",")+`
`;t.forEach(i=>{const _=[`"${i.domain}"`,p(i.download),p(i.upload),p(i.total),`"${i.clientIPs.join("; ")}"`,`"${z(i.lastUpdate)}"`];o+=_.join(",")+`
`});const r=new Blob([o],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(r),c.download=`ppgw-traffic-${Date.now()}.csv`,c.click()},ge=()=>{const t=g();if(t.length===0){alert(n("noData"));return}const s=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`ppgw-traffic-${Date.now()}.json`,o.click()},M=()=>{const t=ie(),s=g();return e.jsxs("div",{className:a.paginationWrapper,children:[e.jsxs("div",{children:[n("showing")||"Showing"," ",d==="all"?s.length:Math.min(d,s.length)," ",n("of")||"of"," ",s.length," ",n("records")||"records"]}),e.jsxs("div",{className:a.pageControls,children:[e.jsxs("label",{children:[n("perPage")||"Per Page",":",e.jsxs("select",{value:d,onChange:o=>de(o.target.value==="all"?"all":parseInt(o.target.value)),className:a.pageSizeSelect,children:[e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"all",children:n("all")||"All"})]})]}),d!=="all"&&t>1&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>b(1),disabled:x===1,className:a.pageBtn,children:"«"}),e.jsx("button",{onClick:()=>b(o=>Math.max(1,o-1)),disabled:x===1,className:a.pageBtn,children:"‹"}),e.jsxs("span",{style:{margin:"0 10px"},children:[x," / ",t]}),e.jsx("button",{onClick:()=>b(o=>Math.min(t,o+1)),disabled:x===t,className:a.pageBtn,children:"›"}),e.jsx("button",{onClick:()=>b(t),disabled:x===t,className:a.pageBtn,children:"»"})]})]})]})},O=ce();return e.jsxs("div",{className:a.pageWrapper,children:[S&&e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill,style:{width:`${q}%`}})}),X&&e.jsx("div",{className:a.refreshNotice,children:n("dataRefreshed")}),te&&e.jsx("div",{className:a.dialogOverlay,children:e.jsxs("div",{className:a.dialogBox,children:[e.jsx("h3",{className:a.dialogTitle,children:n("cleanData")}),e.jsx("p",{children:n("confirmCleanMessage")}),e.jsxs("div",{className:a.dialogButtons,children:[e.jsx("button",{onClick:()=>N(!1),disabled:T,className:a.btn,children:n("cancel")}),e.jsx("button",{onClick:re,disabled:T,className:`${a.btn} ${a.btnDanger}`,children:n(T?"cleaning":"confirm")})]})]})}),e.jsxs("div",{className:a.container,children:[e.jsxs("header",{className:a.header,children:[e.jsxs("div",{className:a.statsContainer,children:[e.jsxs("div",{className:a.statsCards,children:[e.jsxs("div",{className:`${a.statsCard} ${a.statsCardTotal}`,style:{"--download-ratio":`${m.total>0?m.download/m.total*100:50}%`},children:[e.jsx("div",{className:a.statsLabel,children:n("totalTraffic")}),e.jsx("div",{className:a.statsValue,children:p(m.total)})]}),e.jsxs("div",{className:`${a.statsCard} ${a.statsCardDownload}`,children:[e.jsx("div",{className:a.statsLabel,children:n("download")}),e.jsx("div",{className:a.statsValue,children:p(m.download)})]}),e.jsxs("div",{className:`${a.statsCard} ${a.statsCardUpload}`,children:[e.jsx("div",{className:a.statsLabel,children:n("upload")}),e.jsx("div",{className:a.statsValue,children:p(m.upload)})]})]}),e.jsxs("div",{className:a.actionButtons,children:[e.jsx("button",{onClick:ue,className:`${a.btn} ${a.btnSuccess}`,children:n("exportCSV")||"Export CSV"}),e.jsx("button",{onClick:ge,className:a.btn,style:{background:"#ff9500",color:"white",borderColor:"transparent"},children:n("exportJSON")||"Export JSON"}),e.jsx("button",{onClick:()=>N(!0),className:`${a.btn} ${a.btnDanger}`,children:n("cleanData")})]})]}),e.jsxs("div",{className:a.controls,children:[e.jsxs("div",{className:a.controlGroup,children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:S,onChange:t=>J(t.target.checked)}),e.jsx("label",{htmlFor:"autoRefresh",children:n("autoRefresh")||"Auto Refresh"})]}),e.jsxs("div",{className:a.controlGroup,children:[e.jsx("input",{type:"checkbox",id:"autoSort",checked:Y,onChange:t=>{const s=t.target.checked;Z(s),s?(k("lastUpdate"),y("desc")):(k("total"),y("desc"))}}),e.jsx("label",{htmlFor:"autoSort",children:n("autoSortByTime")})]}),e.jsx("button",{onClick:()=>w(),className:a.btn,children:n("refreshData")||"Refresh Data"}),e.jsx("input",{type:"text",placeholder:n("search")||"Search...",value:R,onChange:t=>{Q(t.target.value),se(t.target.value.trim().length>0),b(1)},className:a.searchInput})]})]}),!j&&!f&&g().length>0&&e.jsx("div",{className:a.paginationWrapper+" "+a.top,children:e.jsx(M,{})}),e.jsxs("div",{className:a.tableContainer,children:[j&&e.jsx("div",{className:a.loading,children:n("loading")||"Loading..."}),f&&e.jsx("div",{className:a.error,children:f}),!j&&!f&&g().length===0&&e.jsx("div",{className:a.error,children:ae?n("noSearchResult")||"No results":n("noData")||"No data"}),!j&&!f&&O.length>0&&e.jsxs("table",{className:a.table,children:[e.jsx("thead",{className:a.thead,children:e.jsx("tr",{children:["domain","download","upload","total","clientIPs","lastUpdate"].map(t=>e.jsxs("th",{onClick:()=>le(t),className:`${a.th} ${u===t?a.thActive:""}`,children:[n(t)||t.charAt(0).toUpperCase()+t.slice(1),u===t&&(C==="asc"?" ↑":" ↓")]},t))})}),e.jsx("tbody",{children:O.map((t,s)=>{const o=$.has(s),r=o?t.clientIPs:t.clientIPs.slice(0,3),c=t.clientIPs.length>3;return e.jsxs("tr",{className:a.tr,children:[e.jsx("td",{className:a.td,children:e.jsxs("div",{className:a.domainCell,children:[e.jsx("span",{children:t.domain}),e.jsx("button",{className:a.copyBtn,onClick:i=>he(t.domain,i.currentTarget),children:n("copy")||"Copy"})]})}),e.jsx("td",{className:a.td,children:p(t.download)}),e.jsx("td",{className:a.td,children:p(t.upload)}),e.jsx("td",{className:a.td,children:p(t.total)}),e.jsx("td",{className:a.td,children:e.jsxs("div",{children:[r.map((i,_)=>e.jsx("span",{className:a.ipTag,children:i},_)),c&&!o&&e.jsxs("span",{className:a.moreTag,children:["+",t.clientIPs.length-3]}),c&&e.jsx("button",{onClick:()=>pe(s),className:a.expandBtn,children:o?n("collapse")||"Collapse":n("expand")||"Expand"})]})}),e.jsx("td",{className:a.td,children:z(t.lastUpdate)})]},s)})})]})]}),!j&&!f&&g().length>0&&e.jsx(M,{}),e.jsxs("footer",{className:a.footer,children:["© PaoPaoGateWay | ",e.jsx("a",{href:"https://github.com/kkkgo/PaoPaoGateWay",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})]})]})}export{dt as default};
