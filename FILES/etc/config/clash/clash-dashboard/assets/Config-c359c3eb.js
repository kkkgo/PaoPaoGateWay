import{j as e,s as P,e as v,c as U,h as D,i as S,k as w,l as V,b as N,m as F,g as L,n as G,o as q,q as j,t as z,v as H,u as J,C as W,w as K,x as Q,y as X}from"./index-63736a7a.js";import{r as Y}from"./logs-c4867c0a.js";import{S as C,T as I}from"./Select-8e2bbf8d.js";const{useState:Z,useRef:ee,useEffect:te,useCallback:se}=v;function ne({value:t,...n}){const[o,c]=Z(t),a=ee(t);te(()=>{a.current!==t&&c(t),a.current=t},[t]);const r=se(u=>c(u.target.value),[c]);return e.jsx("input",{className:P.input,value:o,onChange:r,...n})}const ae="_root_1s1gc_1",le="_section_1s1gc_2",oe="_item_1s1gc_14",ce="_sep_1s1gc_34",re="_label_1s1gc_47",d={root:ae,section:le,item:oe,sep:ce,label:re},ie="_fieldset_1ghjp_1",de="_input_1ghjp_9",ue="_cnt_1ghjp_9",_={fieldset:ie,input:de,cnt:ue};function ge({OptionComponent:t,optionPropsList:n,selectedIndex:o,onChange:c}){const a=U("visually-hidden",_.input),r=u=>{c(u.target.value)};return e.jsx("fieldset",{className:_.fieldset,children:n.map((u,p)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:o===p,name:"selection",value:p,"aria-labelledby":"traffic chart type "+p,onChange:r,className:a}),e.jsx("div",{className:_.cnt,children:e.jsx(t,{...u})})]},p))})}const{useMemo:pe}=v,he={maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1,type:"category"},y:{display:!1,type:"linear"}}},R=[23e3,35e3,46e3,33e3,9e4,68e3,23e3,45e3],me=[184e3,183e3,196e3,182e3,19e4,186e3,182e3,189e3],fe=R;function xe({id:t}){const n=D.read(),o=pe(()=>({labels:fe,datasets:[{...S,...w[t].up,data:R},{...S,...w[t].down,data:me}]}),[t]),c="chart-"+t;return V(n.Chart,c,o,null,he),e.jsx("div",{style:{width:100,height:50,padding:5},children:e.jsx("canvas",{id:c})})}const{useEffect:T,useState:je,useCallback:h,useRef:Ce,useMemo:_e}=v,ve=[{id:0},{id:1},{id:2},{id:3}],be=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"],["silent","Silent"]],ye=[["zh","中文"],["en","English"]],ke=[["Global","Global"],["Rule","Rule"],["Direct","Direct"]],Se=t=>({configs:F(t),apiConfig:L(t)}),we=t=>({selectedChartStyleIndex:Q(t),latencyTestUrl:X(t),apiConfig:L(t)}),Ie=N(we)(Le),Ee=N(Se)(Ne);function Ne({dispatch:t,configs:n,apiConfig:o}){return T(()=>{t(G(o))},[t,o]),e.jsx(Ie,{configs:n})}function Le({dispatch:t,configs:n,selectedChartStyleIndex:o,latencyTestUrl:c,apiConfig:a}){const[r,u]=je(n),p=Ce(n);T(()=>{p.current!==n&&u(n),p.current=n},[n]),h(()=>{t(q("apiConfig"))},[t]);const m=h((s,l)=>{u({...r,[s]:l})},[r]),$=h(s=>{const l="allow-lan",i=s;m(l,i),t(j(a,{"allow-lan":i}))},[a,t,m]),f=h(({name:s,value:l})=>{switch(s){case"mode":case"log-level":m(s,l),t(j(a,{[s]:l})),s==="log-level"&&Y({...a,logLevel:l});break;case"redir-port":case"socks-port":case"mixed-port":case"port":if(l!==""){const i=parseInt(l,10);if(i<0||i>65535)return}m(s,l);break;default:return}},[a,t,m]);h(s=>f(s.target),[f]);const{selectChartStyleIndex:E,updateAppConfig:b}=z(),M=h(s=>{const l=s.target,{name:i,value:k}=l;switch(i){case"port":case"socks-port":case"mixed-port":case"redir-port":{const x=parseInt(k,10);if(x<0||x>65535)return;t(j(a,{[i]:x}));break}case"latencyTestUrl":{b(i,k);break}default:throw new Error(`unknown input name ${i}`)}},[a,t,b]),O=_e(()=>{const s=r.mode;return typeof s=="string"&&s[0].toUpperCase()+s.slice(1)},[r.mode]),[A,B]=H(K),{t:g,i18n:y}=J();return e.jsxs("div",{children:[e.jsx(W,{title:g("Config")}),e.jsxs("div",{className:d.root,children:[e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("Mode")}),e.jsx(C,{options:ke,selected:O,onChange:s=>f({name:"mode",value:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("LogLevel")}),e.jsx(C,{options:be,selected:r["log-level"],onChange:s=>f({name:"log-level",value:s.target.value})})]}),e.jsxs("div",{className:d.item,children:[e.jsx(I,{id:"config-allow-lan",checked:r["allow-lan"],onChange:$}),e.jsx("label",{htmlFor:"config-allow-lan",children:g("allow_lan_mixed")})]})]}),e.jsx("div",{className:d.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:d.section,children:[e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("latency_test_url")}),e.jsx(ne,{name:"latencyTestUrl",type:"text",value:c,onBlur:M})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("lang")}),e.jsx("div",{children:e.jsx(C,{options:ye,selected:y.language,onChange:s=>y.changeLanguage(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("chart_style")}),e.jsx(ge,{OptionComponent:xe,optionPropsList:ve,selectedIndex:o,onChange:E})]}),e.jsxs("div",{className:d.item,children:[e.jsx(I,{id:"dark-mode-pure-black-toggle",checked:A,onChange:B}),e.jsx("label",{htmlFor:"dark-mode-pure-black-toggle",children:g("dark_mode_pure_black_toggle_label")})]})]})]})}export{Ee as default};
