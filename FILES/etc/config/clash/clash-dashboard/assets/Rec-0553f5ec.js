import{u as _e,r,j as e}from"./index-7472d2ae.js";const fe="_pageWrapper_1cvgk_1",xe="_container_1cvgk_10",ve="_header_1cvgk_21",me="_statsContainer_1cvgk_27",ke="_statsCards_1cvgk_36",je="_statsCard_1cvgk_36",Ce="_statsCardTotal_1cvgk_61",ye="_statsCardDownload_1cvgk_65",Ne="_statsCardUpload_1cvgk_69",Se="_statsLabel_1cvgk_73",be="_statsValue_1cvgk_79",we="_actionButtons_1cvgk_85",De="_btn_1cvgk_90",Be="_btnPrimary_1cvgk_110",Te="_btnDanger_1cvgk_118",Pe="_btnSuccess_1cvgk_126",Re="_controls_1cvgk_134",Ie="_controlGroup_1cvgk_143",Le="_searchInput_1cvgk_154",$e="_tableContainer_1cvgk_168",Ue="_table_1cvgk_168",Fe="_thead_1cvgk_181",ze="_th_1cvgk_181",Ae="_thActive_1cvgk_203",Me="_tr_1cvgk_208",Oe="_copyBtn_1cvgk_218",We="_td_1cvgk_222",Ve="_domainCell_1cvgk_228",Ee="_ipTag_1cvgk_252",Ge="_moreTag_1cvgk_263",Je="_expandBtn_1cvgk_269",Qe="_paginationWrapper_1cvgk_282",He="_top_1cvgk_291",Ke="_pageControls_1cvgk_296",qe="_pageSizeSelect_1cvgk_302",Xe="_pageBtn_1cvgk_310",Ye="_loading_1cvgk_332",Ze="_error_1cvgk_332",et="_footer_1cvgk_342",tt="_dialogOverlay_1cvgk_356",at="_dialogBox_1cvgk_370",st="_dialogTitle_1cvgk_381",ot="_dialogButtons_1cvgk_385",nt="_progressBar_1cvgk_393",ct="_progressFill_1cvgk_403",rt="_refreshNotice_1cvgk_409",a={pageWrapper:fe,container:xe,header:ve,statsContainer:me,statsCards:ke,statsCard:je,statsCardTotal:Ce,statsCardDownload:ye,statsCardUpload:Ne,statsLabel:Se,statsValue:be,actionButtons:we,btn:De,btnPrimary:Be,btnDanger:Te,btnSuccess:Pe,controls:Re,controlGroup:Ie,searchInput:Le,tableContainer:$e,table:Ue,thead:Fe,th:ze,thActive:Ae,tr:Me,copyBtn:Oe,td:We,domainCell:Ve,ipTag:Ee,moreTag:Ge,expandBtn:Je,paginationWrapper:Qe,top:He,pageControls:Ke,pageSizeSelect:qe,pageBtn:Xe,loading:Ye,error:Ze,footer:et,dialogOverlay:tt,dialogBox:at,dialogTitle:st,dialogButtons:ot,progressBar:nt,progressFill:ct,refreshNotice:rt};function it(){const{t:n,i18n:E}=_e(),[P,G]=r.useState([]),[p,b]=r.useState("total"),[k,j]=r.useState("desc"),[C,J]=r.useState(!1),[R,Q]=r.useState(""),[m,I]=r.useState(!0),[f,w]=r.useState(""),[h,H]=r.useState(null),[L,K]=r.useState(new Set),[q,D]=r.useState(0),[X,$]=r.useState(!1),[Y,Z]=r.useState(!1),[d,U]=r.useState(20),[x,v]=r.useState(1),[B,ee]=r.useState({download:0,upload:0,total:0}),[te,y]=r.useState(!1),[T,F]=r.useState(!1),[ae,se]=r.useState(!1),oe=E.language.toLowerCase().startsWith("zh")?"zh":"en";r.useEffect(()=>{const t="PaoPaoGateWay",s=localStorage.getItem(t);if(!s){window.location.href="/ui/#/rec";return}try{const c=JSON.parse(s);if(!c.clashAPIConfigs||c.clashAPIConfigs.length===0){window.location.href="/ui/#/rec";return}H(c.clashAPIConfigs[0].secret)}catch{window.location.href="/ui/#/rec"}const o=sessionStorage.getItem("ppgw_pageSize");o&&U(o==="all"?"all":parseInt(o))},[]),r.useEffect(()=>{sessionStorage.setItem("ppgw_pageSize",d.toString())},[d]);const ne=t=>{const s=t.reduce((o,c)=>({download:o.download+c.download,upload:o.upload+c.upload,total:o.total+c.total}),{download:0,upload:0,total:0});ee(s)},N=async(t=!1)=>{if(h){w("");try{const s=Math.floor(Date.now()/1e3),o=await fetch("./reckey.json?_="+s);if(!o.ok)throw new Error("Failed to fetch reckey");const l=(await o.json()).reckey;if(!(await fetch("/version",{headers:{Authorization:"Bearer "+h}})).ok){w(n("authError")||"Authentication failed"),setTimeout(()=>{window.location.href="/ui/#/rec"},2e3);return}const W="./rec_data/"+sha256(l+h)+"/data.json?t="+s,S=await fetch(W);if(!S.ok)throw new Error("Failed to fetch data");const V=await S.json();G(V),ne(V),I(!1),$(!0),setTimeout(()=>{$(!1)},500)}catch(s){w(n("error")||"Failed to load data"),I(!1),console.error(s)}}},ce=async()=>{if(h){F(!0);try{const t=Math.floor(Date.now()/1e3),s=await fetch("./reckey.json?_="+t);if(!s.ok)throw new Error("Failed to fetch reckey");const c=(await s.json()).reckey,i="./rec_data/"+sha256(c+h)+"/data_clean.json?t="+t,_=await fetch(i);if(!_.ok)throw new Error("Failed to clean data");if((await _.json()).clean==="ok")await new Promise(S=>setTimeout(S,3e3)),y(!1),await N();else throw new Error("Clean failed")}catch(t){console.error(t),alert(n("cleanError")),y(!1)}finally{F(!1)}}};r.useEffect(()=>{h&&N()},[h]),r.useEffect(()=>{let t=null,s=null;return C&&h?(D(0),s=setTimeout(()=>{N(!0)},3e3),t=setInterval(()=>{D(o=>o+100/30)},100)):D(0),()=>{t&&clearInterval(t),s&&clearTimeout(s)}},[C,h,P]);const g=t=>{if(t===0)return"0 B";const s=1024,o=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,c)).toFixed(2))+" "+o[c]},z=t=>new Date(t).toLocaleString(oe==="zh"?"zh-CN":"en-US"),re=t=>{p===t?j(k==="asc"?"desc":"asc"):(b(t),j("asc"))},u=()=>{let t=P.filter(s=>{const o=R.toLowerCase();return s.domain.toLowerCase().includes(o)||s.clientIPs.some(c=>c.toLowerCase().includes(o))});return p&&t.sort((s,o)=>{let c=s[p],l=o[p];return p==="clientIPs"?(c=c.length,l=l.length):p==="lastUpdate"&&(c=new Date(c),l=new Date(l)),c<l?k==="asc"?-1:1:c>l?k==="asc"?1:-1:0}),t},le=()=>{const t=u();if(d==="all")return t;const s=(x-1)*d;return t.slice(s,s+d)},ie=()=>d==="all"?1:Math.ceil(u().length/d),de=t=>{U(t),v(1)},he=(t,s)=>{const o=c=>{s.textContent=n("copied")||"Copied",s.style.background="#28a745",s.style.color="#fff",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background="",s.style.color=""},1500)};navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>o()).catch(()=>A(t,s)):A(t,s)},A=(t,s)=>{try{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",document.body.appendChild(o),o.select();const c=document.execCommand("copy");if(document.body.removeChild(o),c)s.textContent=n("copied")||"Copied",s.style.background="#28a745",s.style.color="#fff",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background="",s.style.color=""},1500);else throw new Error("Copy failed")}catch{s.textContent=n("copyFailed")||"Failed",s.style.background="#dc3545",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background=""},1500)}},ge=t=>{const s=new Set(L);s.has(t)?s.delete(t):s.add(t),K(s)},pe=()=>{const t=u();if(t.length===0){alert(n("noData"));return}let o=["Domain","Download","Upload","Total","Client IPs","Last Update"].join(",")+`
`;t.forEach(i=>{const _=[`"${i.domain}"`,g(i.download),g(i.upload),g(i.total),`"${i.clientIPs.join("; ")}"`,`"${z(i.lastUpdate)}"`];o+=_.join(",")+`
`});const c=new Blob([o],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(c),l.download=`ppgw-traffic-${Date.now()}.csv`,l.click()},ue=()=>{const t=u();if(t.length===0){alert(n("noData"));return}const s=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`ppgw-traffic-${Date.now()}.json`,o.click()},M=()=>{const t=ie(),s=u();return e.jsxs("div",{className:a.paginationWrapper,children:[e.jsxs("div",{children:[n("showing")||"Showing"," ",d==="all"?s.length:Math.min(d,s.length)," ",n("of")||"of"," ",s.length," ",n("records")||"records"]}),e.jsxs("div",{className:a.pageControls,children:[e.jsxs("label",{children:[n("perPage")||"Per Page",":",e.jsxs("select",{value:d,onChange:o=>de(o.target.value==="all"?"all":parseInt(o.target.value)),className:a.pageSizeSelect,children:[e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"all",children:n("all")||"All"})]})]}),d!=="all"&&t>1&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>v(1),disabled:x===1,className:a.pageBtn,children:"«"}),e.jsx("button",{onClick:()=>v(o=>Math.max(1,o-1)),disabled:x===1,className:a.pageBtn,children:"‹"}),e.jsxs("span",{style:{margin:"0 10px"},children:[x," / ",t]}),e.jsx("button",{onClick:()=>v(o=>Math.min(t,o+1)),disabled:x===t,className:a.pageBtn,children:"›"}),e.jsx("button",{onClick:()=>v(t),disabled:x===t,className:a.pageBtn,children:"»"})]})]})]})},O=le();return e.jsxs("div",{className:a.pageWrapper,children:[C&&e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill,style:{width:`${q}%`}})}),X&&e.jsx("div",{className:a.refreshNotice,children:n("dataRefreshed")}),te&&e.jsx("div",{className:a.dialogOverlay,children:e.jsxs("div",{className:a.dialogBox,children:[e.jsx("h3",{className:a.dialogTitle,children:n("cleanData")}),e.jsx("p",{children:n("confirmCleanMessage")}),e.jsxs("div",{className:a.dialogButtons,children:[e.jsx("button",{onClick:()=>y(!1),disabled:T,className:a.btn,children:n("cancel")}),e.jsx("button",{onClick:ce,disabled:T,className:`${a.btn} ${a.btnDanger}`,children:n(T?"cleaning":"confirm")})]})]})}),e.jsxs("div",{className:a.container,children:[e.jsxs("header",{className:a.header,children:[e.jsxs("div",{className:a.statsContainer,children:[e.jsxs("div",{className:a.statsCards,children:[e.jsxs("div",{className:`${a.statsCard} ${a.statsCardTotal}`,children:[e.jsx("div",{className:a.statsLabel,children:n("totalTraffic")}),e.jsx("div",{className:a.statsValue,children:g(B.total)})]}),e.jsxs("div",{className:`${a.statsCard} ${a.statsCardDownload}`,children:[e.jsx("div",{className:a.statsLabel,children:n("download")}),e.jsx("div",{className:a.statsValue,children:g(B.download)})]}),e.jsxs("div",{className:`${a.statsCard} ${a.statsCardUpload}`,children:[e.jsx("div",{className:a.statsLabel,children:n("upload")}),e.jsx("div",{className:a.statsValue,children:g(B.upload)})]})]}),e.jsxs("div",{className:a.actionButtons,children:[e.jsx("button",{onClick:pe,className:`${a.btn} ${a.btnSuccess}`,children:n("exportCSV")||"Export CSV"}),e.jsx("button",{onClick:ue,className:a.btn,style:{background:"#ff9500",color:"white",borderColor:"transparent"},children:n("exportJSON")||"Export JSON"}),e.jsx("button",{onClick:()=>y(!0),className:`${a.btn} ${a.btnDanger}`,children:n("cleanData")})]})]}),e.jsxs("div",{className:a.controls,children:[e.jsxs("div",{className:a.controlGroup,children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:C,onChange:t=>J(t.target.checked)}),e.jsx("label",{htmlFor:"autoRefresh",children:n("autoRefresh")||"Auto Refresh"})]}),e.jsxs("div",{className:a.controlGroup,children:[e.jsx("input",{type:"checkbox",id:"autoSort",checked:Y,onChange:t=>{const s=t.target.checked;Z(s),s?(b("lastUpdate"),j("desc")):(b("total"),j("desc"))}}),e.jsx("label",{htmlFor:"autoSort",children:n("autoSortByTime")})]}),e.jsx("button",{onClick:()=>N(),className:a.btn,children:n("refreshData")||"Refresh Data"}),e.jsx("input",{type:"text",placeholder:n("search")||"Search...",value:R,onChange:t=>{Q(t.target.value),se(t.target.value.trim().length>0),v(1)},className:a.searchInput})]})]}),!m&&!f&&u().length>0&&e.jsx("div",{className:a.paginationWrapper+" "+a.top,children:e.jsx(M,{})}),e.jsxs("div",{className:a.tableContainer,children:[m&&e.jsx("div",{className:a.loading,children:n("loading")||"Loading..."}),f&&e.jsx("div",{className:a.error,children:f}),!m&&!f&&u().length===0&&e.jsx("div",{className:a.error,children:ae?n("noSearchResult")||"No results":n("noData")||"No data"}),!m&&!f&&O.length>0&&e.jsxs("table",{className:a.table,children:[e.jsx("thead",{className:a.thead,children:e.jsx("tr",{children:["domain","download","upload","total","clientIPs","lastUpdate"].map(t=>e.jsxs("th",{onClick:()=>re(t),className:`${a.th} ${p===t?a.thActive:""}`,children:[n(t)||t.charAt(0).toUpperCase()+t.slice(1),p===t&&(k==="asc"?" ↑":" ↓")]},t))})}),e.jsx("tbody",{children:O.map((t,s)=>{const o=L.has(s),c=o?t.clientIPs:t.clientIPs.slice(0,3),l=t.clientIPs.length>3;return e.jsxs("tr",{className:a.tr,children:[e.jsx("td",{className:a.td,children:e.jsxs("div",{className:a.domainCell,children:[e.jsx("span",{children:t.domain}),e.jsx("button",{className:a.copyBtn,onClick:i=>he(t.domain,i.currentTarget),children:n("copy")||"Copy"})]})}),e.jsx("td",{className:a.td,children:g(t.download)}),e.jsx("td",{className:a.td,children:g(t.upload)}),e.jsx("td",{className:a.td,children:g(t.total)}),e.jsx("td",{className:a.td,children:e.jsxs("div",{children:[c.map((i,_)=>e.jsx("span",{className:a.ipTag,children:i},_)),l&&!o&&e.jsxs("span",{className:a.moreTag,children:["+",t.clientIPs.length-3]}),l&&e.jsx("button",{onClick:()=>ge(s),className:a.expandBtn,children:o?n("collapse")||"Collapse":n("expand")||"Expand"})]})}),e.jsx("td",{className:a.td,children:z(t.lastUpdate)})]},s)})})]})]}),!m&&!f&&u().length>0&&e.jsx(M,{}),e.jsxs("footer",{className:a.footer,children:["© PaoPaoGateWay | ",e.jsx("a",{href:"https://github.com/kkkgo/PaoPaoGateWay",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})]})]})}export{it as default};
