import{u as _e,r as l,j as e}from"./index-a65d2ab4.js";const fe="_pageWrapper_17hyv_2",xe="_container_17hyv_11",ye="_header_17hyv_22",ve="_statsContainer_17hyv_28",me="_statsCards_17hyv_37",je="_statsCard_17hyv_37",Ce="_statsCardTotal_17hyv_62",Ne="_statsCardDownload_17hyv_66",Se="_statsCardUpload_17hyv_70",be="_statsLabel_17hyv_74",we="_statsValue_17hyv_80",ke="_actionButtons_17hyv_86",De="_btn_17hyv_91",Be="_btnPrimary_17hyv_111",Te="_btnDanger_17hyv_119",Pe="_btnSuccess_17hyv_127",Re="_controls_17hyv_135",Ie="_controlGroup_17hyv_144",Le="_searchInput_17hyv_155",$e="_tableContainer_17hyv_169",Ue="_table_17hyv_169",Fe="_thead_17hyv_182",ze="_th_17hyv_182",Ae="_thActive_17hyv_204",Me="_tr_17hyv_209",Oe="_copyBtn_17hyv_219",We="_td_17hyv_223",Ve="_domainCell_17hyv_229",Ee="_ipTag_17hyv_254",Ge="_moreTag_17hyv_275",Je="_expandBtn_17hyv_281",Qe="_paginationWrapper_17hyv_294",He="_top_17hyv_303",Ke="_pageControls_17hyv_308",qe="_pageSizeSelect_17hyv_314",Xe="_pageBtn_17hyv_322",Ye="_loading_17hyv_344",Ze="_error_17hyv_344",et="_footer_17hyv_354",tt="_dialogOverlay_17hyv_368",at="_dialogBox_17hyv_382",st="_dialogTitle_17hyv_393",ot="_dialogButtons_17hyv_397",nt="_progressBar_17hyv_405",rt="_progressFill_17hyv_415",lt="_refreshNotice_17hyv_421",a={pageWrapper:fe,container:xe,header:ye,statsContainer:ve,statsCards:me,statsCard:je,statsCardTotal:Ce,statsCardDownload:Ne,statsCardUpload:Se,statsLabel:be,statsValue:we,actionButtons:ke,btn:De,btnPrimary:Be,btnDanger:Te,btnSuccess:Pe,controls:Re,controlGroup:Ie,searchInput:Le,tableContainer:$e,table:Ue,thead:Fe,th:ze,thActive:Ae,tr:Me,copyBtn:Oe,td:We,domainCell:Ve,ipTag:Ee,moreTag:Ge,expandBtn:Je,paginationWrapper:Qe,top:He,pageControls:Ke,pageSizeSelect:qe,pageBtn:Xe,loading:Ye,error:Ze,footer:et,dialogOverlay:tt,dialogBox:at,dialogTitle:st,dialogButtons:ot,progressBar:nt,progressFill:rt,refreshNotice:lt};function it(){const{t:n,i18n:E}=_e(),[P,G]=l.useState([]),[u,w]=l.useState("total"),[m,j]=l.useState("desc"),[C,J]=l.useState(!1),[R,Q]=l.useState(""),[v,I]=l.useState(!0),[f,k]=l.useState(""),[h,H]=l.useState(null),[L,K]=l.useState(new Set),[q,D]=l.useState(0),[X,$]=l.useState(!1),[Y,Z]=l.useState(!1),[d,U]=l.useState(20),[x,y]=l.useState(1),[B,ee]=l.useState({download:0,upload:0,total:0}),[te,N]=l.useState(!1),[T,F]=l.useState(!1),[ae,se]=l.useState(!1),oe=E.language.toLowerCase().startsWith("zh")?"zh":"en";l.useEffect(()=>{const t="PaoPaoGateWay",s=localStorage.getItem(t);if(!s){window.location.href="/ui/#/rec";return}try{const r=JSON.parse(s);if(!r.clashAPIConfigs||r.clashAPIConfigs.length===0){window.location.href="/ui/#/rec";return}H(r.clashAPIConfigs[0].secret)}catch{window.location.href="/ui/#/rec"}const o=sessionStorage.getItem("ppgw_pageSize");o&&U(o==="all"?"all":parseInt(o))},[]),l.useEffect(()=>{sessionStorage.setItem("ppgw_pageSize",d.toString())},[d]);const ne=t=>{const s=t.reduce((o,r)=>({download:o.download+r.download,upload:o.upload+r.upload,total:o.total+r.total}),{download:0,upload:0,total:0});ee(s)},S=async(t=!1)=>{if(h){k("");try{const s=Math.floor(Date.now()/1e3),o=await fetch("./reckey.json?_="+s);if(!o.ok)throw new Error("Failed to fetch reckey");const c=(await o.json()).reckey;if(!(await fetch("/version",{headers:{Authorization:"Bearer "+h}})).ok){k(n("authError")||"Authentication failed"),setTimeout(()=>{window.location.href="/ui/#/rec"},2e3);return}const W="./rec_data/"+sha256(c+h)+"/data.json?t="+s,b=await fetch(W);if(!b.ok)throw new Error("Failed to fetch data");const V=await b.json();G(V),ne(V),I(!1),$(!0),setTimeout(()=>{$(!1)},500)}catch(s){k(n("error")||"Failed to load data"),I(!1),console.error(s)}}},re=async()=>{if(h){F(!0);try{const t=Math.floor(Date.now()/1e3),s=await fetch("./reckey.json?_="+t);if(!s.ok)throw new Error("Failed to fetch reckey");const r=(await s.json()).reckey,i="./rec_data/"+sha256(r+h)+"/data_clean.json?t="+t,_=await fetch(i);if(!_.ok)throw new Error("Failed to clean data");if((await _.json()).clean==="ok")await new Promise(b=>setTimeout(b,3e3)),N(!1),await S();else throw new Error("Clean failed")}catch(t){console.error(t),alert(n("cleanError")),N(!1)}finally{F(!1)}}};l.useEffect(()=>{h&&S()},[h]),l.useEffect(()=>{let t=null,s=null;return C&&h?(D(0),s=setTimeout(()=>{S(!0)},3e3),t=setInterval(()=>{D(o=>o+100/30)},100)):D(0),()=>{t&&clearInterval(t),s&&clearTimeout(s)}},[C,h,P]);const p=t=>{if(t===0)return"0 B";const s=1024,o=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,r)).toFixed(2))+" "+o[r]},z=t=>new Date(t).toLocaleString(oe==="zh"?"zh-CN":"en-US"),le=t=>{u===t?j(m==="asc"?"desc":"asc"):(w(t),j("asc"))},g=()=>{let t=P.filter(s=>{const o=R.toLowerCase();return s.domain.toLowerCase().includes(o)||s.clientIPs.some(r=>r.toLowerCase().includes(o))});return u&&t.sort((s,o)=>{let r=s[u],c=o[u];return u==="clientIPs"?(r=r.length,c=c.length):u==="lastUpdate"&&(r=new Date(r),c=new Date(c)),r<c?m==="asc"?-1:1:r>c?m==="asc"?1:-1:0}),t},ce=()=>{const t=g();if(d==="all")return t;const s=(x-1)*d;return t.slice(s,s+d)},ie=()=>d==="all"?1:Math.ceil(g().length/d),de=t=>{U(t),y(1)},he=(t,s)=>{const o=r=>{s.textContent=n("copied")||"Copied",s.style.background="#28a745",s.style.color="#fff",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background="",s.style.color=""},1500)};navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>o()).catch(()=>A(t,s)):A(t,s)},A=(t,s)=>{try{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",document.body.appendChild(o),o.select();const r=document.execCommand("copy");if(document.body.removeChild(o),r)s.textContent=n("copied")||"Copied",s.style.background="#28a745",s.style.color="#fff",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background="",s.style.color=""},1500);else throw new Error("Copy failed")}catch{s.textContent=n("copyFailed")||"Failed",s.style.background="#dc3545",setTimeout(()=>{s.textContent=n("copy")||"Copy",s.style.background=""},1500)}},pe=t=>{const s=new Set(L);s.has(t)?s.delete(t):s.add(t),K(s)},ue=()=>{const t=g();if(t.length===0){alert(n("noData"));return}let o=["Domain","Download","Upload","Total","Client IPs","Last Update"].join(",")+`
`;t.forEach(i=>{const _=[`"${i.domain}"`,p(i.download),p(i.upload),p(i.total),`"${i.clientIPs.join("; ")}"`,`"${z(i.lastUpdate)}"`];o+=_.join(",")+`
`});const r=new Blob([o],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(r),c.download=`ppgw-traffic-${Date.now()}.csv`,c.click()},ge=()=>{const t=g();if(t.length===0){alert(n("noData"));return}const s=new Blob([JSON.stringify(t,null,2)],{type:"application/json;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`ppgw-traffic-${Date.now()}.json`,o.click()},M=()=>{const t=ie(),s=g();return e.jsxs("div",{className:a.paginationWrapper,children:[e.jsxs("div",{children:[n("showing")||"Showing"," ",d==="all"?s.length:Math.min(d,s.length)," ",n("of")||"of"," ",s.length," ",n("records")||"records"]}),e.jsxs("div",{className:a.pageControls,children:[e.jsxs("label",{children:[n("perPage")||"Per Page",":",e.jsxs("select",{value:d,onChange:o=>de(o.target.value==="all"?"all":parseInt(o.target.value)),className:a.pageSizeSelect,children:[e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"all",children:n("all")||"All"})]})]}),d!=="all"&&t>1&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>y(1),disabled:x===1,className:a.pageBtn,children:"«"}),e.jsx("button",{onClick:()=>y(o=>Math.max(1,o-1)),disabled:x===1,className:a.pageBtn,children:"‹"}),e.jsxs("span",{style:{margin:"0 10px"},children:[x," / ",t]}),e.jsx("button",{onClick:()=>y(o=>Math.min(t,o+1)),disabled:x===t,className:a.pageBtn,children:"›"}),e.jsx("button",{onClick:()=>y(t),disabled:x===t,className:a.pageBtn,children:"»"})]})]})]})},O=ce();return e.jsxs("div",{className:a.pageWrapper,children:[C&&e.jsx("div",{className:a.progressBar,children:e.jsx("div",{className:a.progressFill,style:{width:`${q}%`}})}),X&&e.jsx("div",{className:a.refreshNotice,children:n("dataRefreshed")}),te&&e.jsx("div",{className:a.dialogOverlay,children:e.jsxs("div",{className:a.dialogBox,children:[e.jsx("h3",{className:a.dialogTitle,children:n("cleanData")}),e.jsx("p",{children:n("confirmCleanMessage")}),e.jsxs("div",{className:a.dialogButtons,children:[e.jsx("button",{onClick:()=>N(!1),disabled:T,className:a.btn,children:n("cancel")}),e.jsx("button",{onClick:re,disabled:T,className:`${a.btn} ${a.btnDanger}`,children:n(T?"cleaning":"confirm")})]})]})}),e.jsxs("div",{className:a.container,children:[e.jsxs("header",{className:a.header,children:[e.jsxs("div",{className:a.statsContainer,children:[e.jsxs("div",{className:a.statsCards,children:[e.jsxs("div",{className:`${a.statsCard} ${a.statsCardTotal}`,children:[e.jsx("div",{className:a.statsLabel,children:n("totalTraffic")}),e.jsx("div",{className:a.statsValue,children:p(B.total)})]}),e.jsxs("div",{className:`${a.statsCard} ${a.statsCardDownload}`,children:[e.jsx("div",{className:a.statsLabel,children:n("download")}),e.jsx("div",{className:a.statsValue,children:p(B.download)})]}),e.jsxs("div",{className:`${a.statsCard} ${a.statsCardUpload}`,children:[e.jsx("div",{className:a.statsLabel,children:n("upload")}),e.jsx("div",{className:a.statsValue,children:p(B.upload)})]})]}),e.jsxs("div",{className:a.actionButtons,children:[e.jsx("button",{onClick:ue,className:`${a.btn} ${a.btnSuccess}`,children:n("exportCSV")||"Export CSV"}),e.jsx("button",{onClick:ge,className:a.btn,style:{background:"#ff9500",color:"white",borderColor:"transparent"},children:n("exportJSON")||"Export JSON"}),e.jsx("button",{onClick:()=>N(!0),className:`${a.btn} ${a.btnDanger}`,children:n("cleanData")})]})]}),e.jsxs("div",{className:a.controls,children:[e.jsxs("div",{className:a.controlGroup,children:[e.jsx("input",{type:"checkbox",id:"autoRefresh",checked:C,onChange:t=>J(t.target.checked)}),e.jsx("label",{htmlFor:"autoRefresh",children:n("autoRefresh")||"Auto Refresh"})]}),e.jsxs("div",{className:a.controlGroup,children:[e.jsx("input",{type:"checkbox",id:"autoSort",checked:Y,onChange:t=>{const s=t.target.checked;Z(s),s?(w("lastUpdate"),j("desc")):(w("total"),j("desc"))}}),e.jsx("label",{htmlFor:"autoSort",children:n("autoSortByTime")})]}),e.jsx("button",{onClick:()=>S(),className:a.btn,children:n("refreshData")||"Refresh Data"}),e.jsx("input",{type:"text",placeholder:n("search")||"Search...",value:R,onChange:t=>{Q(t.target.value),se(t.target.value.trim().length>0),y(1)},className:a.searchInput})]})]}),!v&&!f&&g().length>0&&e.jsx("div",{className:a.paginationWrapper+" "+a.top,children:e.jsx(M,{})}),e.jsxs("div",{className:a.tableContainer,children:[v&&e.jsx("div",{className:a.loading,children:n("loading")||"Loading..."}),f&&e.jsx("div",{className:a.error,children:f}),!v&&!f&&g().length===0&&e.jsx("div",{className:a.error,children:ae?n("noSearchResult")||"No results":n("noData")||"No data"}),!v&&!f&&O.length>0&&e.jsxs("table",{className:a.table,children:[e.jsx("thead",{className:a.thead,children:e.jsx("tr",{children:["domain","download","upload","total","clientIPs","lastUpdate"].map(t=>e.jsxs("th",{onClick:()=>le(t),className:`${a.th} ${u===t?a.thActive:""}`,children:[n(t)||t.charAt(0).toUpperCase()+t.slice(1),u===t&&(m==="asc"?" ↑":" ↓")]},t))})}),e.jsx("tbody",{children:O.map((t,s)=>{const o=L.has(s),r=o?t.clientIPs:t.clientIPs.slice(0,3),c=t.clientIPs.length>3;return e.jsxs("tr",{className:a.tr,children:[e.jsx("td",{className:a.td,children:e.jsxs("div",{className:a.domainCell,children:[e.jsx("span",{children:t.domain}),e.jsx("button",{className:a.copyBtn,onClick:i=>he(t.domain,i.currentTarget),children:n("copy")||"Copy"})]})}),e.jsx("td",{className:a.td,children:p(t.download)}),e.jsx("td",{className:a.td,children:p(t.upload)}),e.jsx("td",{className:a.td,children:p(t.total)}),e.jsx("td",{className:a.td,children:e.jsxs("div",{children:[r.map((i,_)=>e.jsx("span",{className:a.ipTag,children:i},_)),c&&!o&&e.jsxs("span",{className:a.moreTag,children:["+",t.clientIPs.length-3]}),c&&e.jsx("button",{onClick:()=>pe(s),className:a.expandBtn,children:o?n("collapse")||"Collapse":n("expand")||"Expand"})]})}),e.jsx("td",{className:a.td,children:z(t.lastUpdate)})]},s)})})]})]}),!v&&!f&&g().length>0&&e.jsx(M,{}),e.jsxs("footer",{className:a.footer,children:["© PaoPaoGateWay | ",e.jsx("a",{href:"https://github.com/kkkgo/PaoPaoGateWay",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})]})]})}export{it as default};
